<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLE í…ŒìŠ¤íŠ¸ ì¸í„°í˜ì´ìŠ¤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .control-panel {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button#connectBtn {
            background-color: #2196F3;
        }
        
        button#connectBtn:hover {
            background-color: #0b7dda;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        input, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        #commandInput {
            flex-grow: 1;
        }
        
        #logOutput {
            width: 100%;
            height: 300px;
            background-color: #f5f5f5;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-y: auto;
            resize: vertical;
        }
        
        .connection-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ff0000;
            margin-right: 5px;
        }
        
        .connection-status.connected {
            background-color: #00ff00;
        }
        
        .status-bar {
            display: flex;
            align-items: center;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .flex-row {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BLE í…ŒìŠ¤íŠ¸ ì¸í„°í˜ì´ìŠ¤</h1>
        
        <div class="flex-row">
            <button id="connectBtn">ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°</button>
            <button id="disconnectBtn" disabled>ì—°ê²° í•´ì œ</button>
        </div>
        
        <div class="control-panel">
            <input type="text" id="commandInput" placeholder="ë¸”ë£¨íˆ¬ìŠ¤ ëª…ë ¹ì–´ ì…ë ¥ (ì˜ˆ: LED:ON)">
            <button id="sendBtn" disabled>ì „ì†¡</button>
        </div>
        
        <div>
            <h3>ë¡œê·¸ ì¶œë ¥</h3>
            <div id="logOutput"></div>
        </div>
        
        <div class="status-bar">
            <span class="connection-status" id="statusIndicator"></span>
            <span id="statusText">ì—°ê²° ì•ˆë¨</span>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="integratedBleLib.js"></script>
    
    <script>
        // DOM ìš”ì†Œ
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const commandInput = document.getElementById('commandInput');
        const sendBtn = document.getElementById('sendBtn');
        const logOutput = document.getElementById('logOutput');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        
        // ì„¼ì„œ ê°ì²´ë“¤ì„ ì „ì—­ìœ¼ë¡œ ì„ ì–¸
        let bleConnection;   // BLE ì—°ê²° ê´€ë¦¬ ê°ì²´
        let led;             // LED ì œì–´ (ì¼œê¸°/ë„ê¸°/ê¹œë¹¡ì„/ë°ê¸° ì¡°ì ˆ)
        let lightSensor;     // ì¡°ë„ì„¼ì„œ (ë¹› ê°ì§€)
        let ultrasonicSensor; // ì´ˆìŒíŒŒ ì„¼ì„œ (ê±°ë¦¬ ì¸¡ì •)
        let dhtSensor;       // ì˜¨ìŠµë„ ì„¼ì„œ (ì˜¨ë„/ìŠµë„ ì¸¡ì •)
        let touchSensor;     // í„°ì¹˜ ì„¼ì„œ (ì ‘ì´‰ ê°ì§€)
        let servoMotor;      // ì„œë³´ ëª¨í„° (ê°ë„ ì œì–´)
        
        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            let prefix = '';
            
            switch(type) {
                case 'error':
                    prefix = 'âŒ ì˜¤ë¥˜: ';
                    break;
                case 'success':
                    prefix = 'âœ… ì„±ê³µ: ';
                    break;
                case 'command':
                    prefix = 'ğŸ“¤ ëª…ë ¹ì–´: ';
                    break;
                case 'response':
                    prefix = 'ğŸ“¥ ì‘ë‹µ: ';
                    break;
                case 'warning':
                    prefix = 'âš ï¸ ê²½ê³ : ';
                    break;
                default:
                    prefix = 'â„¹ï¸ ì •ë³´: ';
            }
            
            logOutput.innerHTML += `[${timestamp}] ${prefix}${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight; // ìë™ ìŠ¤í¬ë¡¤
        }
        
        // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateConnectionStatus(connected) {
            if (connected === true || connected === 'connected') {
                statusIndicator.classList.add('connected');
                statusText.textContent = 'ì—°ê²°ë¨';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                sendBtn.disabled = false;
            } else {
                statusIndicator.classList.remove('connected');
                statusText.textContent = 'ì—°ê²° ì•ˆë¨';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                sendBtn.disabled = true;
            }
        }
        
        // ë¡œê·¸ í•¨ìˆ˜ ì „ì—­ìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°
        window.log = log;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë“  ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener('load', function() {
            console.log('í˜ì´ì§€ ì™„ì „íˆ ë¡œë“œë¨, ì´ˆê¸°í™” ì‹œì‘');
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'info');

            // ìƒìˆ˜ ë° BLE ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸
            if (typeof IOT_SERVICE === 'undefined' || typeof BLEManager === 'undefined') {
                log('BLE ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹¤íŒ¨. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ë³´ì„¸ìš”.', 'error');
                return;
            }
            
            log('BLE ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì„±ê³µ', 'success');
            
            try {
                // ì„¼ì„œ ê°ì²´ë“¤ ì´ˆê¸°í™” (í˜ì´ì§€ ì™„ì „íˆ ë¡œë“œëœ í›„)
                bleConnection = new BLEManager();       // BLE ì—°ê²° ê´€ë¦¬ì ìƒì„±
                log('BLE ì—°ê²° ê´€ë¦¬ì ì´ˆê¸°í™” ì™„ë£Œ', 'info');
                
                // BLE ê´€ë¦¬ì ì´ˆê¸°í™”
                bleConnection.init();
                log('BLEManager ì´ˆê¸°í™” ì™„ë£Œ', 'info');
                
                // ì„¼ì„œ ê°ì²´ ìƒì„±
                led = new LED();                       // LED ì œì–´ í´ë˜ìŠ¤ ìƒì„±
                lightSensor = new LightSensor();       // ì¡°ë„ì„¼ì„œ í´ë˜ìŠ¤ ìƒì„±
                ultrasonicSensor = new UltrasonicSensor(); // ì´ˆìŒíŒŒ ì„¼ì„œ í´ë˜ìŠ¤ ìƒì„±
                dhtSensor = new DHTSensor();           // ì˜¨ìŠµë„ ì„¼ì„œ í´ë˜ìŠ¤ ìƒì„±
                touchSensor = new TouchSensor();       // í„°ì¹˜ ì„¼ì„œ í´ë˜ìŠ¤ ìƒì„±
                servoMotor = new ServoMotor();         // ì„œë³´ ëª¨í„° í´ë˜ìŠ¤ ìƒì„±
                log('ì„¼ì„œ ê°ì²´ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                
                // ì „ì—­ ë³€ìˆ˜ë¡œ ë“±ë¡ (í•„ìš”ì— ë”°ë¼ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
                window.bleConnection = bleConnection;
                window.led = led;
                window.lightSensor = lightSensor;
                window.ultrasonicSensor = ultrasonicSensor;
                window.dhtSensor = dhtSensor;
                window.touchSensor = touchSensor;
                window.servoMotor = servoMotor;
                
                // BleLib ì „ì—­ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                window.BleLib.onDataReceived(function(data) {
                    console.log("=== BLE ë°ì´í„° ìˆ˜ì‹ ë¨(ì „ì—­) ===");
                    console.log("UUID:", data.characteristicUUID);
                    console.log("ë°ì´í„°:", data.data);
                    
                    // ì¡°ë„ì„¼ì„œ ê´€ë ¨ ë””ë²„ê¹…
                    if (data.characteristicUUID === LIGHT_CHARACTERISTIC) {
                        console.log("ì¡°ë„ì„¼ì„œ ë°ì´í„° ê°ì§€ë¨!");
                        log(`ğŸ” BLE ì¡°ë„ì„¼ì„œ ë°ì´í„° ê°ì§€ë¨ (ì „ì—­ ë¦¬ìŠ¤ë„ˆ)`, 'info');
                    }
                });
                
                // ë¸Œë¼ìš°ì € ë¸”ë£¨íˆ¬ìŠ¤ ì§€ì› í™•ì¸
                if (!navigator.bluetooth) {
                    log('ì´ ë¸Œë¼ìš°ì €ëŠ” Web Bluetooth APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    log('Chrome ë˜ëŠ” Edge ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.', 'error');
                    connectBtn.disabled = true;
                } else {
                    log('Web Bluetooth API ì§€ì›ë¨', 'success');
                    log('ì‹¤í–‰ í™˜ê²½: ' + (window.isSecureContext ? 'Secure Context (OK)' : 'Not Secure Context (Problem)'), 'info');
                    if (!window.isSecureContext) {
                        log('ë¸”ë£¨íˆ¬ìŠ¤ APIëŠ” HTTPS ë˜ëŠ” localhostì—ì„œë§Œ ì‘ë™í•©ë‹ˆë‹¤', 'error');
                    }
                }
                
                // ì´ì œ ëª¨ë“  ê°ì²´ê°€ ì´ˆê¸°í™”ëœ í›„ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                initEventListeners();
                
                log('ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¥ì¹˜ì— ì—°ê²°í•˜ì„¸ìš”', 'info');
            } catch (error) {
                log(`ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
        });
        
        // ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” í•¨ìˆ˜
        function initEventListeners() {
            // LED ì„¼ì„œ ë°ì´í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            led.onData(function(data) {
                log(`LED ìƒíƒœ: ${data.state}, ì„±ê³µ: ${data.success}`, 'response');
            });
            
            // ì¡°ë„ì„¼ì„œ ë°ì´í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            lightSensor.onData(function(data) {
                console.log("ì¡°ë„ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹ :", data);
                // ì•„ë‚ ë¡œê·¸ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ì¡°ë„ ë ˆë²¨ ê³„ì‚°
                let lightLevel = "ì•Œ ìˆ˜ ì—†ìŒ";
                if (data.analog !== null && data.analog !== undefined) {
                    if (data.analog < 100) lightLevel = "ë§¤ìš° ë°ìŒ";
                    else if (data.analog < 300) lightLevel = "ë°ìŒ";
                    else if (data.analog < 600) lightLevel = "ë³´í†µ";
                    else if (data.analog < 800) lightLevel = "ì–´ë‘ì›€";
                    else lightLevel = "ë§¤ìš° ì–´ë‘ì›€";
                }
                log(`ì¡°ë„ìƒíƒœ: ${lightLevel} (ì•„ë‚ ë¡œê·¸ê°’: ${data.analog})`, 'response');
            });
            
            // ì´ˆìŒíŒŒ ì„¼ì„œ ë°ì´í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            ultrasonicSensor.onData(function(data) {
                log(`ì´ˆìŒíŒŒ ì„¼ì„œ: ê±°ë¦¬=${data.distance}cm`, 'response');
            });
            
            // ì˜¨ìŠµë„ ì„¼ì„œ ë°ì´í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            dhtSensor.onData(function(data) {
                log(`ì˜¨ìŠµë„ ì„¼ì„œ: ì˜¨ë„=${data.temperature}Â°C, ìŠµë„=${data.humidity}%`, 'response');
            });
            
            // í„°ì¹˜ ì„¼ì„œ ë°ì´í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            touchSensor.onData(function(data) {
                log(`í„°ì¹˜ ì„¼ì„œ: ${data.touched ? 'í„°ì¹˜ë¨' : 'í„°ì¹˜ ì•ˆë¨'}`, 'response');
            });
            
            // ì„œë³´ ëª¨í„° ë°ì´í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            servoMotor.onData(function(data) {
                log(`ì„œë³´ ëª¨í„°: ${data.raw}`, 'response');
            });
            
            // BLE ì—°ê²° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
            bleConnection.onConnected(function(device) {
                log(`ì¥ì¹˜ì— ì—°ê²°ë¨: ${device.name}`, 'success');
                updateConnectionStatus(true);
            });
            
            bleConnection.onDisconnected(function(data) {
                log(`ì¥ì¹˜ ì—°ê²° í•´ì œ: ${data.message}`, 'info');
                updateConnectionStatus(false);
            });
            
            bleConnection.onConnectionFailed(function(message) {
                log(`ì—°ê²° ì‹¤íŒ¨: ${message}`, 'error');
                updateConnectionStatus(false);
            });
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
            connectBtn.addEventListener('click', handleConnectButtonClick);
            disconnectBtn.addEventListener('click', handleDisconnectButtonClick);
            sendBtn.addEventListener('click', handleSendButtonClick);
            
            // Enter í‚¤ë¡œ ëª…ë ¹ì–´ ì „ì†¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            commandInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter' && !sendBtn.disabled) {
                    sendBtn.click();
                }
            });
        }
        
        // ì—°ê²° ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        async function handleConnectButtonClick() {
            log('ë¸”ë£¨íˆ¬ìŠ¤ ì¥ì¹˜ ì—°ê²° ì‹œë„...', 'info');
            try {
                // Web Bluetooth API ì§€ì› ì—¬ë¶€ í™•ì¸
                if (!navigator.bluetooth) {
                    log('ì´ ë¸Œë¼ìš°ì €ëŠ” Web Bluetooth APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                log('Web Bluetooth API ì§€ì›: ' + (!!navigator.bluetooth), 'info');
                
                // ë¸”ë£¨íˆ¬ìŠ¤ ê°€ìš©ì„± í™•ì¸
                try {
                    const availableDevices = await navigator.bluetooth.getAvailability();
                    log('ë¸”ë£¨íˆ¬ìŠ¤ ì‚¬ìš© ê°€ëŠ¥: ' + availableDevices, 'info');
                } catch (e) {
                    log('ë¸”ë£¨íˆ¬ìŠ¤ ê°€ìš©ì„± í™•ì¸ ì˜¤ë¥˜: ' + e.message, 'info');
                }
                
                // ì—°ê²° ì‹œë„
                await bleConnection.connect();
            } catch (error) {
                log(`ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`ìƒì„¸ ì˜¤ë¥˜: ${error.stack || 'ìƒì„¸ ì •ë³´ ì—†ìŒ'}`, 'error');
            }
        }
        
        // ì—°ê²° í•´ì œ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        function handleDisconnectButtonClick() {
            log('ë¸”ë£¨íˆ¬ìŠ¤ ì¥ì¹˜ ì—°ê²° í•´ì œ ì¤‘...', 'info');
            bleConnection.disconnect();
        }
        
        // ëª…ë ¹ì–´ ì „ì†¡ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        async function handleSendButtonClick() {
            const command = commandInput.value.trim();
            if (!command) {
                log('ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }
            
            log(`ëª…ë ¹ì–´ ì „ì†¡: ${command}`, 'command');
            try {
                // ëª…ë ¹ì–´ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì²˜ë¦¬ í•¨ìˆ˜ í˜¸ì¶œ
                if (command.startsWith("LED:")) {
                    await handleLEDCommand(command);
                } 
                else if (command.startsWith("LIGHT:")) {
                    await handleLightSensorCommand(command);
                }
                else if (command.startsWith("ULTRA:")) {
                    await handleUltrasonicCommand(command);
                }
                else if (command.startsWith("DHT:")) {
                    await handleDHTCommand(command);
                }
                else if (command.startsWith("TOUCH:")) {
                    await handleTouchCommand(command);
                }
                else if (command.startsWith("SERVO:")) {
                    await handleServoCommand(command);
                } 
                else {
                    await handleOtherCommand(command);
                }
            } catch (error) {
                log(`ëª…ë ¹ì–´ ì „ì†¡ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // LED ëª…ë ¹ì–´ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleLEDCommand(command) {
            if (command === "LED:ON") {
                await led.turnOn();
                log('LED ì¼œê¸° ëª…ë ¹ ì „ì†¡ ì„±ê³µ', 'success');
            } else if (command === "LED:OFF") {
                await led.turnOff();
                log('LED ë„ê¸° ëª…ë ¹ ì „ì†¡ ì„±ê³µ', 'success');
            } else if (command.startsWith("LED:BLINK:")) {
                const interval = parseInt(command.split(':')[2]) || 1000;
                await led.blink(interval);
                log(`LED ê¹œë¹¡ì„ ëª…ë ¹ ì „ì†¡ ì„±ê³µ (ê°„ê²©: ${interval}ms)`, 'success');
            } else if (command.startsWith("LED:BRIGHTNESS:")) {
                const brightness = parseInt(command.split(':')[2]) || 50;
                await led.setBrightness(brightness);
                log(`LED ë°ê¸° ì„¤ì • ëª…ë ¹ ì „ì†¡ ì„±ê³µ (ë°ê¸°: ${brightness}%)`, 'success');
            } else if (command.startsWith("LED:PIN:")) {
                const pin = parseInt(command.split(':')[2]) || 13;
                await led.setPin(pin);
                log(`LED í•€ ì„¤ì • ëª…ë ¹ ì „ì†¡ ì„±ê³µ (í•€: ${pin})`, 'success');
            } else {
                // ê¸°íƒ€ LED ëª…ë ¹ì–´ëŠ” ì¼ë°˜ sendCommand ì‚¬ìš©
                await led.sendCommand(command);
                log('LED ëª…ë ¹ ì „ì†¡ ì„±ê³µ', 'success');
            }
        }
        
        // ì¡°ë„ì„¼ì„œ ëª…ë ¹ì–´ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleLightSensorCommand(command) {
            if (command === "LIGHT:STATUS") {
                await lightSensor.getStatus();
                log('ì¡°ë„ì„¼ì„œ ìƒíƒœ ìš”ì²­ ì „ì†¡ ì„±ê³µ', 'success');
            } else if (command.startsWith("LIGHT:PIN:")) {
                const pins = command.split(':')[2].split(',');
                if (pins.length === 2) {
                    await lightSensor.setPin(parseInt(pins[0]), parseInt(pins[1]));
                    log(`ì¡°ë„ì„¼ì„œ í•€ ì„¤ì • ì „ì†¡ ì„±ê³µ (ì•„ë‚ ë¡œê·¸: ${pins[0]}, ë””ì§€í„¸: ${pins[1]})`, 'success');
                } else {
                    await lightSensor.setPin(parseInt(pins[0]));
                    log(`ì¡°ë„ì„¼ì„œ í•€ ì„¤ì • ì „ì†¡ ì„±ê³µ (ì•„ë‚ ë¡œê·¸: ${pins[0]})`, 'success');
                }
            } else {
                // ê¸°íƒ€ ì¡°ë„ì„¼ì„œ ëª…ë ¹ì–´ëŠ” ì¼ë°˜ sendCommand ì‚¬ìš©
                await lightSensor.sendCommand(command);
                log('ì¡°ë„ì„¼ì„œ ëª…ë ¹ ì „ì†¡ ì„±ê³µ', 'success');
            }
        }
        
        // ì´ˆìŒíŒŒ ì„¼ì„œ ëª…ë ¹ì–´ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleUltrasonicCommand(command) {
            await ultrasonicSensor.sendCommand(command);
            log('ì´ˆìŒíŒŒ ì„¼ì„œ ëª…ë ¹ ì „ì†¡ ì„±ê³µ', 'success');
        }
        
        // ì˜¨ìŠµë„ ì„¼ì„œ ëª…ë ¹ì–´ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleDHTCommand(command) {
            await dhtSensor.sendCommand(command);
            log('ì˜¨ìŠµë„ ì„¼ì„œ ëª…ë ¹ ì „ì†¡ ì„±ê³µ', 'success');
        }
        
        // í„°ì¹˜ ì„¼ì„œ ëª…ë ¹ì–´ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleTouchCommand(command) {
            await touchSensor.sendCommand(command);
            log('í„°ì¹˜ ì„¼ì„œ ëª…ë ¹ ì „ì†¡ ì„±ê³µ', 'success');
        }
        
        // ì„œë³´ ëª¨í„° ëª…ë ¹ì–´ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleServoCommand(command) {
            await servoMotor.sendCommand(command);
            log('ì„œë³´ ëª¨í„° ëª…ë ¹ ì „ì†¡ ì„±ê³µ', 'success');
        }
        
        // ê¸°íƒ€ ëª…ë ¹ì–´ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleOtherCommand(command) {
            // ëª…ë ¹ì–´ ìœ í˜•ì— ë”°ë¥¸ íŠ¹ì„± UUID ê²°ì •
            let characteristicUUID;
            
            if (command.startsWith('CAM:')) {
                characteristicUUID = CAM_CHARACTERISTIC;
            } else if (command.startsWith('NEO:') || command.startsWith('NEO_')) {
                characteristicUUID = NEOPIXEL_CHARACTERISTIC;
            } else if (command.startsWith('BUZ:') || command.startsWith('BUZZER:')) {
                characteristicUUID = BUZZER_CHARACTERISTIC;
            } else if (command.startsWith('REPL:')) {
                characteristicUUID = REPL_CHARACTERISTIC;
            } else if (command.startsWith('GYRO:')) {
                characteristicUUID = GYRO_CHARACTERISTIC;
            } else {
                // ê¸°ë³¸ê°’ìœ¼ë¡œ LED íŠ¹ì„± ì‚¬ìš©
                characteristicUUID = LED_CHARACTERISTIC;
                console.warn(`ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ í˜•ì‹ì…ë‹ˆë‹¤: ${command}. LED íŠ¹ì„±ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.`);
            }
            
            // BleLibìœ¼ë¡œ ì§ì ‘ ì „ì†¡
            await window.BleLib.sendCommand(characteristicUUID, command);
            log('ëª…ë ¹ì–´ ì „ì†¡ ì„±ê³µ', 'success');
        }
    </script>
</body>
</html>